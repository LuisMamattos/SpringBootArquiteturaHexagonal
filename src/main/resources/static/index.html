<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Templates-Luis</title>
    <style>
      /* Reset básico */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: #f5f6fa;
        padding: 40px;
        display: flex;
        justify-content: center;
      }

      .container {
        width: 100%;
        max-width: 800px;
      }

      h2 {
        color: #2f3640;
        margin-bottom: 15px;
        text-align: center;
      }

      .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 30px;
        transition: transform 0.2s;
      }

      .card:hover {
        transform: translateY(-3px);
      }

      .form-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      input {
        flex: 1;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #dcdde1;
        font-size: 16px;
        transition: border 0.2s;
      }

      input:focus {
        border-color: #0097e6;
        outline: none;
      }

      button {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        background: #0097e6;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.2s, transform 0.2s;
      }

      button:hover {
        background: #00a8ff;
        transform: translateY(-2px);
      }

      ul {
        list-style: none;
        margin-top: 10px;
      }

      li {
        background: #f1f2f6;
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 15px;
      }

      li span {
        font-weight: bold;
        color: #2f3640;
      }

      .delete-btn {
        background: #ff4d4f;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 3px 8px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .delete-btn:hover {
        background: #ff7875;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Cadastro Clientes -->
      <div class="card">
        <h2>Cadastro de Clientes</h2>
        <div class="form-group">
          <input id="nomeCliente" placeholder="Nome" />
          <input id="emailCliente" placeholder="Email" />
          <button onclick="atualizarCliente()">Atualizar</button>
          <button onclick="cadastrarCliente()">Cadastrar</button>
          <button onclick="listarClientes()">Listar</button>
        </div>
        <ul id="listaClientes"></ul>
      </div>

      <!-- Cadastro Produtos -->
      <div class="card">
        <h2>Cadastro de Produtos</h2>
        <div class="form-group">
          <input id="nomeProduto" placeholder="Nome" />
          <input id="precoProduto" placeholder="Preço" type="number" />
          <button onclick="cadastrarProduto()">Cadastrar</button>
          <button onclick="listarProdutos()">Listar</button>
        </div>
        <ul id="listaProdutos"></ul>
      </div>
    </div>

    <script>
      // Clientes
      async function cadastrarCliente() {
        const nome = document.getElementById("nomeCliente").value;
        const email = document.getElementById("emailCliente").value;
        if (!nome || !email) return alert("Preencha todos os campos!");
        await fetch("/clientes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, email }),
        });
        alert("Cliente cadastrado!");
        document.getElementById("nomeCliente").value = "";
        document.getElementById("emailCliente").value = "";
        listarClientes();
      }
      function preencherCamposCliente(id, nome, email) {
        document.getElementById("nomeCliente").value = nome;
        document.getElementById("emailCliente").value = email;
        // Guardar id para o update
        document.getElementById("nomeCliente").dataset.id = id;
      }

      async function listarClientes() {
        const res = await fetch("/clientes");
        const clientes = await res.json();
        const lista = document.getElementById("listaClientes");
        lista.innerHTML = "";
        clientes.forEach((c) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${c.id}</span> - ${c.nome} (${c.email})
            <button class="update-btn" onclick="preencherCamposCliente('${c.id}', '${c.nome}', '${c.email}')">Edit</button>

            <button class="delete-btn" onclick="deletarCliente('${c.id}')">X</button>
          `;
          lista.appendChild(li);
        });
      }

      async function deletarCliente(id) {
        if (!confirm("Deseja deletar este cliente?")) return;
        const res = await fetch(`/clientes/${id}`, { method: "DELETE" });
        if (res.ok) {
          alert("Cliente deletado!");
          listarClientes();
        } else alert("Erro ao deletar cliente.");
      }

      // Produtos
      async function cadastrarProduto() {
        const nome = document.getElementById("nomeProduto").value;
        const preco = parseFloat(document.getElementById("precoProduto").value);
        if (!nome || isNaN(preco))
          return alert("Preencha todos os campos corretamente!");
        await fetch("/produtos", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, preco }),
        });
        alert("Produto cadastrado!");
        document.getElementById("nomeProduto").value = "";
        document.getElementById("precoProduto").value = "";
        listarProdutos();
      }

      async function listarProdutos() {
        const res = await fetch("/produtos");
        const produtos = await res.json();
        const lista = document.getElementById("listaProdutos");
        lista.innerHTML = "";
        produtos.forEach((p) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${p.id}</span> - ${p.nome} (R$${p.preco.toFixed(2)})
            <button class="delete-btn" onclick="deletarProduto('${
              p.id
            }')">X</button>
          `;
          lista.appendChild(li);
        });
      }

      async function deletarProduto(id) {
        if (!confirm("Deseja deletar este produto?")) return;
        const res = await fetch(`/produtos/${id}`, { method: "DELETE" });
        if (res.ok) {
          alert("Produto deletado!");
          listarProdutos();
        } else alert("Erro ao deletar produto.");
      }
      async function atualizarCliente() {
        const id = document.getElementById("nomeCliente").dataset.id;
        const nome = document.getElementById("nomeCliente").value;
        const email = document.getElementById("emailCliente").value;
        if (!id) return alert("Selecione um cliente para atualizar!");
        const res = await fetch(`/clientes/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, email }),
        });
        if (res.ok) {
          alert("Cliente atualizado!");
          document.getElementById("nomeCliente").value = "";
          document.getElementById("emailCliente").value = "";
          document.getElementById("nomeCliente").removeAttribute("data-id");
          listarClientes();
        } else alert("Erro ao atualizar cliente.");
      }
    </script>
  </body>
</html>
